[pytest]
# =============================================================================
# PYTEST CONFIGURATION
# =============================================================================
# 
# This file configures pytest behavior for the backend test suite.
# 
# Key Settings:
# - testpaths: Where to find tests
# - python_files: Test file naming pattern
# - markers: Custom test markers for organization
# - addopts: Default command-line options
# =============================================================================

# =============================================================================
# TEST DISCOVERY
# =============================================================================

# Directories to search for tests
testpaths = tests

# Pattern for test files
python_files = test_*.py *_test.py

# Pattern for test classes
python_classes = Test*

# Pattern for test functions
python_functions = test_*

# =============================================================================
# MARKERS
# =============================================================================
# 
# Markers organize tests into categories:
#   pytest -m unit          # Run only unit tests
#   pytest -m "not slow"    # Skip slow tests
#   pytest -m integration   # Run integration tests
# =============================================================================

markers =
    unit: marks tests as unit tests (fast, isolated)
    integration: marks tests as integration tests (uses database/external services)
    slow: marks tests as slow (deselect with '-m "not slow"')
    e2e: marks tests as end-to-end tests
    smoke: marks tests as smoke tests (quick sanity checks)

# =============================================================================
# COVERAGE SETTINGS
# =============================================================================
# 
# Code coverage measures what percentage of code is executed by tests.
# 
# Targets:
#   80%+ overall is good
#   90%+ for critical code
#   100% is unrealistic and not always useful
# 
# Reports:
#   html: Pretty HTML report with line highlighting
#   term-missing: Console output showing missed lines
#   xml: For CI/CD integration
# =============================================================================

addopts = 
    --cov=backend
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-fail-under=70
    -v
    --tb=short
    -ra

# Note: --cov-fail-under=70 means build fails if coverage < 70%
# Note: -ra shows summary of all test outcomes
# Note: --tb=short gives shorter tracebacks

# =============================================================================
# ASYNC SETTINGS
# =============================================================================

# For testing async code
asyncio_mode = auto

# =============================================================================
# LOGGING
# =============================================================================

log_cli = true
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %H:%M:%S

# =============================================================================
# FILTERING
# =============================================================================

# Don't capture output (useful for debugging)
# addopts = -s

# Ignore these directories
norecursedirs = 
    .git
    .venv
    __pycache__
    *.egg-info
    build
    dist
    node_modules

# =============================================================================
# PYTEST PLUGINS
# =============================================================================
# 
# Useful pytest plugins:
#   pytest-cov         Coverage reporting
#   pytest-xdist       Parallel test execution
#   pytest-asyncio     Async test support
#   pytest-mock        Enhanced mocking
#   pytest-timeout     Test timeouts
#   pytest-randomly    Randomize test order
#   pytest-clarity     Better assertion diffs
# =============================================================================
